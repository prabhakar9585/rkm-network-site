<!DOCTYPE html>
<html>
<head>
<title>Admin Dashboard</title>
<link rel="stylesheet" href="style.css">
<style>
.tabs { display:flex; gap:10px; margin:20px; }
.tab { flex:1; padding:12px; color:white; text-align:center; cursor:pointer; font-weight:bold; }
.pending{ background:orange;}
.resolved{ background:green;}
.application{ background:blue;}
.container{ display:flex; gap:20px; padding:20px;}
.list{ width:40%;}
.details{ width:60%; background:white; padding:20px; border-radius:8px;}
.card{ background:white; padding:10px; margin-bottom:10px; cursor:pointer;}
</style>
</head>
<body>

<div class="tabs">
  <div class="tab pending" id="pendingTab">Pending Faults (0)</div>
  <div class="tab resolved" id="resolvedTab">Resolved Faults (0)</div>
  <div class="tab application" id="appTab">New Applications</div>
</div>

<div class="container">
  <div class="list" id="list"></div>
  <div class="details" id="details">Select item to view details</div>
</div>

<script type="module">
import { db } from "./firebase-init.js";
import {
  collection,
  query,
  where,
  getDocs,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const list = document.getElementById("list");
const details = document.getElementById("details");

async function loadPending(){
  list.innerHTML="";
  const q = query(collection(db,"faults"), where("status","==","pending"));
  const snap = await getDocs(q);

  document.getElementById("pendingTab").innerText = "Pending Faults ("+snap.size+")";

  snap.forEach(d=>{
    const data = d.data();
    const div = document.createElement("div");
    div.className="card";
    div.innerText = data.name + " - " + data.phone;
    div.onclick = ()=>{
      details.innerHTML = `
        <h3>${data.name}</h3>
        <p>Phone: ${data.phone}</p>
        <p>Complaint: ${data.complaint}</p>
        <textarea id="solution" placeholder="Write resolution"></textarea><br><br>
        <button onclick="resolve('${d.id}')">Mark Resolved</button>
      `;
    };
    list.appendChild(div);
  });
}

window.resolve = async function(id){
  const solution = document.getElementById("solution").value;
  await updateDoc(doc(db,"faults",id),{
    status:"resolved",
    solution:solution
  });
  loadPending();
  loadResolved();
  details.innerHTML="Resolved Successfully";
}

async function loadResolved(){
  const q = query(collection(db,"faults"), where("status","==","resolved"));
  const snap = await getDocs(q);
  document.getElementById("resolvedTab").innerText="Resolved Faults ("+snap.size+")";
}

async function loadApplications(){
  list.innerHTML="";
  const snap = await getDocs(collection(db,"applications"));
  snap.forEach(d=>{
    const data = d.data();
    const div = document.createElement("div");
    div.className="card";
    div.innerText = data.name + " - " + data.phone;
    div.onclick=()=>{
      details.innerHTML = `
        <h3>${data.name}</h3>
        <p>Phone: ${data.phone}</p>
        <p>Address: ${data.address}</p>
        <p>Area: ${data.area}</p>
      `;
    };
    list.appendChild(div);
  });
}

document.getElementById("pendingTab").onclick=loadPending;
document.getElementById("resolvedTab").onclick=loadResolved;
document.getElementById("appTab").onclick=loadApplications;

loadPending();
loadResolved();
</script>

</body>
</html>
