<!DOCTYPE html>
<html>
<head>
    <title>Pending Faults</title>
    <link rel="stylesheet" href="style.css">
    <script type="module">
        import { db } from "./firebase-init.js";
        import {
            collection,
            getDocs,
            updateDoc,
            doc,
            query,
            where,
            orderBy
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const container = document.getElementById("list");

        async function loadPending() {
            const q = query(
                collection(db, "faults"),
                where("status", "==", "pending"),
                orderBy("createdAt", "desc")
            );

            const snapshot = await getDocs(q);

            snapshot.forEach((docSnap) => {
                const data = docSnap.data();

                const div = document.createElement("div");
                div.className = "card";

                div.innerHTML = `
                    <p><b>Landline:</b> ${data.landline}</p>
                    <p><b>Name:</b> ${data.name}</p>
                    <p><b>Fault:</b> ${data.fault}</p>
                    <p><b>Location:</b> ${data.location}</p>

                    <textarea placeholder="Enter solution" id="sol-${docSnap.id}"></textarea>
                    <button onclick="resolveFault('${docSnap.id}')">Resolve</button>
                `;

                container.appendChild(div);
            });
        }

        window.resolveFault = async function(id) {
            const solution = document.getElementById("sol-" + id).value;

            await updateDoc(doc(db, "faults", id), {
                status: "resolved",
                solution: solution
            });

            alert("Marked as Resolved");
            location.reload();
        }

        window.onload = loadPending;
    </script>
</head>
<body>

<header>
    <h2>Pending Faults</h2>
</header>

<div id="list" class="vertical-list"></div>

</body>
</html>
